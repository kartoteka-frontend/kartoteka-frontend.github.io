var C=Object.defineProperty,A=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var k=(t,e,n)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,u=(t,e)=>{for(var n in e||(e={}))D.call(e,n)&&k(t,n,e[n]);if(w)for(var n of w(e))U.call(e,n)&&k(t,n,e[n]);return t},m=(t,e)=>A(t,G(e));import{_ as y,T as v}from"./index.31fc017f.js";import{h as f,o as l,c,F as p,a as d,t as _,d as h,b as g,g as E,v as M,q as B,s as I,i as S}from"./vendor.db9d2b8c.js";const F={name:"Group",components:{Table:v},props:{name:String,manager:String,members:Array,isMember:Boolean,users:Array,edit:Boolean,canEdit:Boolean,onEdit:Function,onUpdate:Function,onCancel:Function,onDelete:Function,onAccept:Function,onReject:Function,assignments:Array,assign:Boolean,onAssign:Function,onAssignUpdate:Function,onAssignCancel:Function,documents:Array,onAssignmentClick:Function},data(){return{membersHeader:{active:{label:"\u010Clen",width:10,align:"center",noFilter:!0,type:"check"},name:{label:"Meno",width:45},email:{label:"Email",width:45}},usersHeader:{added:{label:"Pridan\xFD",width:10,align:"center",noFilter:!0,type:"check"},name:{label:"Meno",width:45},email:{label:"Email",width:45}},documentsHeader:{added:{label:"Priraden\xFD",width:10,align:"center",noFilter:!0,type:"check"},name:{label:"N\xE1zov",width:35},author:{label:"Autor",width:35},date_to:{label:"D\xE1tom do",width:20,type:"date"}},assignmentsHeader:{name:{label:"N\xE1zov",width:25},author:{label:"Autor",width:25},date_from:{label:"D\xE1tum od",width:25},date_to:{label:"D\xE1tum do",width:25}},addedUsers:[],addedDocuments:[]}},computed:{id(){return this.$route.params.id},filteredUsers(){return this.users.map(e=>this.addedUsers.includes(e._id)?{_id:e._id,name:e.name,email:e.email,active:e.active||!1,added:!e.added}:e)},filteredDocuments(){return this.documents.map(e=>this.addedDocuments.includes(e._id)?{_id:e._id,name:e.name,author:e.author,date_from:e.date_from,date_to:e.date_to,added:!e.added}:e)}},methods:{getMembers(){const t=this.filteredUsers.filter(e=>e.added).map(e=>({member:e._id,active:e.active||!1}));return this.addedUsers=[],{name:this.name,members:t}},getAssignments(){const t=new Date;let e=new Date;e.setDate(e.getDate()+7);const n=this.filteredDocuments.filter(o=>o.added).map(o=>({document_id:o._id,date_from:o.date_from?new Date(o.date_from):t,date_to:o.date_to?new Date(o.date_to):e}));return this.addedDocuments=[],n},onUserClick(t){this.addedUsers.includes(t)?this.addedUsers=this.addedUsers.filter(e=>e!=t):this.addedUsers.push(t)},onDocumentClick(t,e,n){n.target.tagName!="INPUT"&&(this.addedDocuments.includes(t)?this.addedDocuments=this.addedDocuments.filter(o=>o!=t):this.addedDocuments.push(t))}}},b=t=>(B("data-v-8726ecd0"),t=t(),I(),t),x={class:"group"},N={class:"flex"},H={key:0},T={key:1},V=b(()=>d("br",null,null,-1)),j={class:"inputs"},R={class:"inputGroup"},z=b(()=>d("label",{for:"name"},"N\xE1zov: ",-1)),P={class:"buttons"},O=b(()=>d("h2",null,"Dokumenty",-1)),Z={class:"buttons"};function q(t,e,n,o,s,a){const r=f("Table");return l(),c("div",x,[!n.edit&&!n.assign?(l(),c(p,{key:0},[d("div",N,[d("h1",null,_(n.name),1),n.canEdit?(l(),c("div",H,[d("button",{class:"editButton",onClick:e[0]||(e[0]=(...i)=>n.onEdit&&n.onEdit(...i))},"Upravi\u0165"),d("button",{class:"editButton ml",onClick:e[1]||(e[1]=(...i)=>n.onAssign&&n.onAssign(...i))},"Priradi\u0165 dokument")])):h("",!0),n.canEdit?h("",!0):(l(),c("div",T,[n.isMember?h("",!0):(l(),c("button",{key:0,class:"editButton",onClick:e[2]||(e[2]=(...i)=>n.onAccept&&n.onAccept(...i))},"Potvrdi\u0165")),d("button",{class:"deleteButton",onClick:e[3]||(e[3]=(...i)=>n.onReject&&n.onReject(...i))},_(n.isMember?"Opusti\u0165":"Zamietnu\u0165"),1)]))]),d("h2",null,_(n.manager),1),g(r,{header:s.membersHeader,data:n.members,onClick:()=>{}},null,8,["header","data","onClick"]),V,g(r,{header:s.assignmentsHeader,data:n.assignments,onClick:n.onAssignmentClick},null,8,["header","data","onClick"])],64)):h("",!0),n.edit?(l(),c(p,{key:1},[d("div",j,[d("div",R,[z,E(d("input",{type:"text",id:"name",name:"name","onUpdate:modelValue":e[4]||(e[4]=i=>n.name=i)},null,512),[[M,n.name]])])]),g(r,{header:s.usersHeader,data:a.filteredUsers,onClick:a.onUserClick},null,8,["header","data","onClick"]),d("div",P,[d("button",{class:"updateButton",onClick:e[5]||(e[5]=i=>n.onUpdate(a.getMembers()))},_(a.id=="new"?"Vytvori\u0165":"Aktualizova\u0165"),1),d("button",{class:"cancelButton",onClick:e[6]||(e[6]=(...i)=>n.onCancel&&n.onCancel(...i))},"Zru\u0161i\u0165"),a.id!="new"?(l(),c("button",{key:0,class:"deleteButton",onClick:e[7]||(e[7]=(...i)=>n.onDelete&&n.onDelete(...i))},"Odstr\xE1ni\u0165")):h("",!0)])],64)):h("",!0),n.assign?(l(),c(p,{key:2},[O,g(r,{header:s.documentsHeader,data:a.filteredDocuments,onClick:a.onDocumentClick},null,8,["header","data","onClick"]),d("div",Z,[d("button",{class:"updateButton",onClick:e[8]||(e[8]=i=>n.onAssignUpdate(a.getAssignments()))},"Aktualizova\u0165"),d("button",{class:"cancelButton",onClick:e[9]||(e[9]=(...i)=>n.onAssignCancel&&n.onAssignCancel(...i))},"Zru\u0161i\u0165")])],64)):h("",!0)])}var J=y(F,[["render",q],["__scopeId","data-v-8726ecd0"]]);const K={name:"GroupView",components:{Table:v,Group:J},data(){return{groups:[],header:{status:{label:"Status",width:10,align:"center"},name:{label:"N\xE1zov",width:45},manager:{label:"Mana\u017E\xE9r",width:45}},name:"",manager:"",isMember:!1,members:[],users:[],edit:!1,canEdit:!1,assignments:[],assign:!1,documents:[]}},computed:{id(){return this.$route.params.id}},methods:{async getGroups(){try{const e=(await this.$api.getGroups()).data.map(n=>{var o,s,a;return{name:n.name,manager:`${(o=n.manager_id)==null?void 0:o.name} (${(s=n.manager_id)==null?void 0:s.email})`,status:window.localStorage.getItem("user")==n.manager_id.name?"Mana\u017E\xE9r":(a=n.members.filter(r=>r.member.name==window.localStorage.getItem("user"))[0])!=null&&a.active?"\u010Clen":"",_id:n._id}});this.groups=e}catch(t){console.log(t)}},async getGroup(){var t,e,n,o,s,a;try{if(this.id!="new"){const r=await this.$api.getGroup(this.id);this.name=(t=r.data)==null?void 0:t.name,this.manager=(n=(e=r.data)==null?void 0:e.manager_id)==null?void 0:n.name,this.members=(o=r.data)==null?void 0:o.members.map(i=>({name:i.member.name,email:i.member.email,active:i.active,_id:i.member._id})),this.isMember=(a=(s=this.members)==null?void 0:s.filter(i=>i.name==window.localStorage.getItem("user"))[0])==null?void 0:a.active}await this.getAssignments()}catch(r){console.log(r)}},async getGroupEdit(){var t;try{if(this.id=="new")this.canEdit=!0;else{const e=await this.$api.getGroupEdit(this.id);this.canEdit=(t=e.data)==null?void 0:t.canEdit}}catch(e){console.log(e)}},async getUsers(){try{const t=await this.$api.getUsers();let e=[];for(let n of t.data){let o=!1;for(let s of this.members)if(n._id==s._id){e.push(m(u({},s),{added:!0})),o=!0;break}o||e.push(m(u({},n),{added:!1}))}this.users=e}catch(t){console.log(t)}},async getDocuments(){try{const t=await this.$api.getDocuments();let e=[];for(let n of t.data){let o=!1;for(let s of this.assignments)if(s.document_id==n._id){e.push(m(u({},n),{added:!0,date_from:s.date_from,date_to:s.date_to})),o=!0;break}o||e.push(m(u({},n),{added:!1}))}this.documents=e}catch(t){console.log(t)}},async getAssignments(){try{const t=await this.$api.getAssignments(this.id);this.assignments=t.data.map(e=>m(u({},e),{date_from:new Date(e.date_from).toISOString().slice(0,10),date_to:new Date(e.date_to).toISOString().slice(0,10),name:e.document_id.name,author:e.document_id.author,document_id:e.document_id._id}))}catch(t){console.log(t)}},async onGroupUpdate(t){var e;try{if(this.id=="new"){const n=await this.$api.createGroup(t);this.$router.push({name:"groupId",params:{id:(e=n.data)==null?void 0:e._id}})}else await this.$api.updateGroup(m(u({},t),{id:this.id}));this.edit=!1,this.getGroups(),this.getGroup()}catch(n){console.log(n)}},async onAssignUpdate(t){try{await this.$api.updateAssignments({documents:t,group_id:this.id}),this.assign=!1,this.getGroup()}catch(e){console.log(e)}},async onMemberClick(t){try{await this.$api.updateMember({id:this.id})}catch(e){console.log(e)}},onEditCancel(){this.edit=!1,this.id=="new"&&this.$router.push({name:"group"})},onAssignCancel(){this.assign=!1},async onGroupDelete(){try{await this.$api.deleteGroup(this.id),await this.getGroups(),this.$router.push({name:"group"})}catch(t){console.log(t)}},async onEdit(){this.edit=!0,await this.getUsers()},async onAssign(){this.assign=!0,await this.getDocuments()},newGroup(){this.edit=!0,this.$router.push({name:"groupId",params:{id:"new"}})},openGroup(t){this.$router.push({name:"groupId",params:{id:t}})},onAssignmentClick(t,e){this.canEdit?this.$router.push({name:"progressId",params:{id:t}}):this.$router.push({name:"documentId",params:{id:e==null?void 0:e.document_id}})},async onAccept(){try{const t=this.members.map(e=>(e.name==window.localStorage.getItem("user")&&(e.active=!0),{member:e._id,active:e.active}));await this.$api.updateGroup({members:t,id:this.id}),this.getGroups(),this.getGroup()}catch(t){console.log(t)}},async onReject(){try{const t=this.members.filter(e=>e.name!=window.localStorage.getItem("user")).map(e=>({member:e._id,active:e.active}));await this.$api.updateGroup({members:t,id:this.id}),this.getGroups(),this.$router.push({name:"group"})}catch(t){console.log(t)}}},watch:{id:{handler:async function(t){t&&this.$route.name=="groupId"?(this.getGroup(),this.getGroupEdit()):(this.name="",this.manager="",this.members=[],this.edit=!1,this.assign=!1)},immediate:!0},canEdit:{handler:function(t){t||(this.edit=!1)},immediate:!0}},created(){this.getGroups()}},L={class:"groups main"},Q={class:"flex"},W=d("h1",null,"Skupiny",-1);function X(t,e,n,o,s,a){const r=f("Table"),i=f("Group");return l(),c("div",L,[a.id?(l(),S(i,{key:1,name:s.name,manager:s.manager,members:s.members,isMember:s.isMember,users:s.users,edit:s.edit,canEdit:s.canEdit,onEdit:a.onEdit,onUpdate:a.onGroupUpdate,onCancel:a.onEditCancel,onDelete:a.onGroupDelete,onMemberClick:a.onMemberClick,onAccept:a.onAccept,onReject:a.onReject,assignments:s.assignments,assign:s.assign,onAssign:a.onAssign,onAssignUpdate:a.onAssignUpdate,onAssignCancel:a.onAssignCancel,documents:s.documents,onAssignmentClick:a.onAssignmentClick},null,8,["name","manager","members","isMember","users","edit","canEdit","onEdit","onUpdate","onCancel","onDelete","onMemberClick","onAccept","onReject","assignments","assign","onAssign","onAssignUpdate","onAssignCancel","documents","onAssignmentClick"])):(l(),c(p,{key:0},[d("div",Q,[W,d("button",{class:"newButton",onClick:e[0]||(e[0]=Y=>a.newGroup())},"+ Nov\xE1")]),g(r,{header:s.header,data:s.groups,onClick:a.openGroup},null,8,["header","data","onClick"])],64))])}var ne=y(K,[["render",X]]);export{ne as default};
