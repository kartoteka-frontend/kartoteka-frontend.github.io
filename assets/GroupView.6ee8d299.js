var C=Object.defineProperty,A=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var k=(t,e,s)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,u=(t,e)=>{for(var s in e||(e={}))D.call(e,s)&&k(t,s,e[s]);if(w)for(var s of w(e))U.call(e,s)&&k(t,s,e[s]);return t},m=(t,e)=>A(t,G(e));import{_ as y,T as v}from"./index.4b665ec2.js";import{h as f,o as l,c,F as p,a as o,t as _,d as h,b as g,g as E,v as M,q as B,s as I,i as S}from"./vendor.db9d2b8c.js";const F={name:"Group",components:{Table:v},props:{name:String,manager:String,members:Array,isMember:Boolean,users:Array,edit:Boolean,canEdit:Boolean,onEdit:Function,onUpdate:Function,onCancel:Function,onDelete:Function,onAccept:Function,onReject:Function,assignments:Array,assign:Boolean,onAssign:Function,onAssignUpdate:Function,onAssignCancel:Function,documents:Array,onAssignmentClick:Function},data(){return{membersHeader:{active:{label:"\u010Clen",width:10,align:"center",noFilter:!0,type:"check"},name:{label:"Meno",width:45},email:{label:"Email",width:45}},usersHeader:{added:{label:"Pridan\xFD",width:10,align:"center",noFilter:!0,type:"check"},name:{label:"Meno",width:45},email:{label:"Email",width:45}},documentsHeader:{added:{label:"Priraden\xFD",width:10,align:"center",noFilter:!0,type:"check"},name:{label:"N\xE1zov",width:35},author:{label:"Autor",width:35},date_to:{label:"D\xE1tom do",width:20,type:"date"}},assignmentsHeader:{name:{label:"N\xE1zov",width:25},author:{label:"Autor",width:25},date_from:{label:"D\xE1tum od",width:25},date_to:{label:"D\xE1tum do",width:25}},addedUsers:[],addedDocuments:[]}},computed:{id(){return this.$route.params.id},filteredUsers(){return this.users.map(e=>this.addedUsers.includes(e._id)?{_id:e._id,name:e.name,email:e.email,active:e.active||!1,added:!e.added}:e)},filteredDocuments(){return this.documents.map(e=>this.addedDocuments.includes(e._id)?{_id:e._id,name:e.name,author:e.author,date_from:e.date_from,date_to:e.date_to,added:!e.added}:e)}},methods:{getMembers(){const t=this.filteredUsers.filter(e=>e.added).map(e=>({member:e._id,active:e.active||!1}));return this.addedUsers=[],{name:this.name,members:t}},getAssignments(){const t=new Date;let e=new Date;e.setDate(e.getDate()+7);const s=this.filteredDocuments.filter(d=>d.added).map(d=>({document_id:d._id,date_from:d.date_from?new Date(d.date_from):t,date_to:d.date_to?new Date(d.date_to):e}));return this.addedDocuments=[],s},onUserClick(t){this.addedUsers.includes(t)?this.addedUsers=this.addedUsers.filter(e=>e!=t):this.addedUsers.push(t)},onDocumentClick(t,e,s){s.target.tagName!="INPUT"&&(this.addedDocuments.includes(t)?this.addedDocuments=this.addedDocuments.filter(d=>d!=t):this.addedDocuments.push(t))}}},b=t=>(B("data-v-8726ecd0"),t=t(),I(),t),x={class:"group"},N={class:"flex"},H={key:0},T={key:1},V=b(()=>o("br",null,null,-1)),j={class:"inputs"},R={class:"inputGroup"},z=b(()=>o("label",{for:"name"},"N\xE1zov: ",-1)),P={class:"buttons"},O=b(()=>o("h2",null,"Dokumenty",-1)),Z={class:"buttons"};function q(t,e,s,d,n,a){const r=f("Table");return l(),c("div",x,[!s.edit&&!s.assign?(l(),c(p,{key:0},[o("div",N,[o("h1",null,_(s.name),1),s.canEdit?(l(),c("div",H,[o("button",{class:"editButton",onClick:e[0]||(e[0]=(...i)=>s.onEdit&&s.onEdit(...i))},"Upravi\u0165"),o("button",{class:"editButton ml",onClick:e[1]||(e[1]=(...i)=>s.onAssign&&s.onAssign(...i))},"Priradi\u0165 dokument")])):h("",!0),s.canEdit?h("",!0):(l(),c("div",T,[s.isMember?h("",!0):(l(),c("button",{key:0,class:"editButton",onClick:e[2]||(e[2]=(...i)=>s.onAccept&&s.onAccept(...i))},"Potvrdi\u0165")),o("button",{class:"deleteButton",onClick:e[3]||(e[3]=(...i)=>s.onReject&&s.onReject(...i))},_(s.isMember?"Opusti\u0165":"Zamietnu\u0165"),1)]))]),o("h2",null,_(s.manager),1),g(r,{header:n.membersHeader,data:s.members,onClick:()=>{}},null,8,["header","data","onClick"]),V,g(r,{header:n.assignmentsHeader,data:s.assignments,onClick:s.onAssignmentClick},null,8,["header","data","onClick"])],64)):h("",!0),s.edit?(l(),c(p,{key:1},[o("div",j,[o("div",R,[z,E(o("input",{type:"text",id:"name",name:"name","onUpdate:modelValue":e[4]||(e[4]=i=>s.name=i)},null,512),[[M,s.name]])])]),g(r,{header:n.usersHeader,data:a.filteredUsers,onClick:a.onUserClick},null,8,["header","data","onClick"]),o("div",P,[o("button",{class:"updateButton",onClick:e[5]||(e[5]=i=>s.onUpdate(a.getMembers()))},_(a.id=="new"?"Vytvori\u0165":"Aktualizova\u0165"),1),o("button",{class:"cancelButton",onClick:e[6]||(e[6]=(...i)=>s.onCancel&&s.onCancel(...i))},"Zru\u0161i\u0165"),a.id!="new"?(l(),c("button",{key:0,class:"deleteButton",onClick:e[7]||(e[7]=(...i)=>s.onDelete&&s.onDelete(...i))},"Odstr\xE1ni\u0165")):h("",!0)])],64)):h("",!0),s.assign?(l(),c(p,{key:2},[O,g(r,{header:n.documentsHeader,data:a.filteredDocuments,onClick:a.onDocumentClick},null,8,["header","data","onClick"]),o("div",Z,[o("button",{class:"updateButton",onClick:e[8]||(e[8]=i=>s.onAssignUpdate(a.getAssignments()))},"Aktualizova\u0165"),o("button",{class:"cancelButton",onClick:e[9]||(e[9]=(...i)=>s.onAssignCancel&&s.onAssignCancel(...i))},"Zru\u0161i\u0165")])],64)):h("",!0)])}var J=y(F,[["render",q],["__scopeId","data-v-8726ecd0"]]);const K={name:"GroupView",components:{Table:v,Group:J},data(){return{groups:[],header:{status:{label:"Status",width:10,align:"center"},name:{label:"N\xE1zov",width:45},manager:{label:"Mana\u017E\xE9r",width:45}},name:"",manager:"",isMember:!1,members:[],users:[],edit:!1,canEdit:!1,assignments:[],assign:!1,documents:[]}},computed:{id(){return this.$route.params.id}},methods:{async getGroups(){try{const e=(await this.$api.getGroups()).data.map(s=>{var d,n,a;return{name:s.name,manager:`${(d=s.manager_id)==null?void 0:d.name} (${(n=s.manager_id)==null?void 0:n.email})`,status:window.localStorage.getItem("user")==s.manager_id.name?"Mana\u017E\xE9r":(a=s.members.filter(r=>r.member.name==window.localStorage.getItem("user"))[0])!=null&&a.active?"\u010Clen":"",_id:s._id}});this.groups=e}catch(t){console.log(t)}},async getGroup(){var t,e,s,d,n,a;try{if(this.id!="new"){const r=await this.$api.getGroup(this.id);this.name=(t=r.data)==null?void 0:t.name,this.manager=(s=(e=r.data)==null?void 0:e.manager_id)==null?void 0:s.name,this.members=(d=r.data)==null?void 0:d.members.map(i=>({name:i.member.name,email:i.member.email,active:i.active,_id:i.member._id})),this.isMember=(a=(n=this.members)==null?void 0:n.filter(i=>i.name==window.localStorage.getItem("user"))[0])==null?void 0:a.active}await this.getAssignments()}catch(r){console.log(r)}},async getGroupEdit(){var t;try{if(this.id=="new")this.canEdit=!0;else{const e=await this.$api.getGroupEdit(this.id);this.canEdit=(t=e.data)==null?void 0:t.canEdit}}catch(e){console.log(e)}},async getUsers(){try{const t=await this.$api.getUsers();let e=[];for(let s of t.data){let d=!1;for(let n of this.members)if(s._id==n._id){e.push(m(u({},n),{added:!0})),d=!0;break}d||e.push(m(u({},s),{added:!1}))}this.users=e}catch(t){console.log(t)}},async getDocuments(){try{const t=await this.$api.getDocuments();let e=[];for(let s of t.data){let d=!1;for(let n of this.assignments)if(n.document_id==s._id){e.push(m(u({},s),{added:!0,date_from:n.date_from,date_to:n.date_to})),d=!0;break}d||e.push(m(u({},s),{added:!1}))}this.documents=e}catch(t){console.log(t)}},async getAssignments(){if(this.id!="new")try{const t=await this.$api.getAssignments(this.id);this.assignments=t.data.map(e=>m(u({},e),{date_from:new Date(e.date_from).toISOString().slice(0,10),date_to:new Date(e.date_to).toISOString().slice(0,10),name:e.document_id.name,author:e.document_id.author,document_id:e.document_id._id}))}catch(t){console.log(t)}},async onGroupUpdate(t){var e;try{if(this.id=="new"){const s=await this.$api.createGroup(t);this.$router.push({name:"groupId",params:{id:(e=s.data)==null?void 0:e._id}})}else await this.$api.updateGroup(m(u({},t),{id:this.id}));this.edit=!1,this.getGroups(),this.getGroup()}catch(s){console.log(s)}},async onAssignUpdate(t){try{await this.$api.updateAssignments({documents:t,group_id:this.id}),this.assign=!1,this.getGroup()}catch(e){console.log(e)}},async onMemberClick(t){try{await this.$api.updateMember({id:this.id})}catch(e){console.log(e)}},onEditCancel(){this.edit=!1,this.id=="new"&&this.$router.push({name:"group"})},onAssignCancel(){this.assign=!1},async onGroupDelete(){try{await this.$api.deleteGroup(this.id),await this.getGroups(),this.$router.push({name:"group"})}catch(t){console.log(t)}},async onEdit(){this.edit=!0,await this.getUsers()},async onAssign(){this.assign=!0,await this.getDocuments()},async newGroup(){this.edit=!0,await this.getUsers(),this.$router.push({name:"groupId",params:{id:"new"}})},openGroup(t){this.$router.push({name:"groupId",params:{id:t}})},onAssignmentClick(t,e){this.canEdit?this.$router.push({name:"progressId",params:{id:t}}):this.$router.push({name:"documentId",params:{id:e==null?void 0:e.document_id}})},async onAccept(){try{const t=this.members.map(e=>(e.name==window.localStorage.getItem("user")&&(e.active=!0),{member:e._id,active:e.active}));await this.$api.updateGroup({members:t,id:this.id}),this.getGroups(),this.getGroup()}catch(t){console.log(t)}},async onReject(){try{const t=this.members.filter(e=>e.name!=window.localStorage.getItem("user")).map(e=>({member:e._id,active:e.active}));await this.$api.updateGroup({members:t,id:this.id}),this.getGroups(),this.$router.push({name:"group"})}catch(t){console.log(t)}}},watch:{id:{handler:async function(t){t&&this.$route.name=="groupId"?(this.getGroup(),this.getGroupEdit()):(this.name="",this.manager="",this.members=[],this.edit=!1,this.assign=!1)},immediate:!0},canEdit:{handler:function(t){t||(this.edit=!1)},immediate:!0}},created(){this.getGroups()}},L={class:"groups main"},Q={class:"flex"},W=o("h1",null,"Skupiny",-1);function X(t,e,s,d,n,a){const r=f("Table"),i=f("Group");return l(),c("div",L,[a.id?(l(),S(i,{key:1,name:n.name,manager:n.manager,members:n.members,isMember:n.isMember,users:n.users,edit:n.edit,canEdit:n.canEdit,onEdit:a.onEdit,onUpdate:a.onGroupUpdate,onCancel:a.onEditCancel,onDelete:a.onGroupDelete,onMemberClick:a.onMemberClick,onAccept:a.onAccept,onReject:a.onReject,assignments:n.assignments,assign:n.assign,onAssign:a.onAssign,onAssignUpdate:a.onAssignUpdate,onAssignCancel:a.onAssignCancel,documents:n.documents,onAssignmentClick:a.onAssignmentClick},null,8,["name","manager","members","isMember","users","edit","canEdit","onEdit","onUpdate","onCancel","onDelete","onMemberClick","onAccept","onReject","assignments","assign","onAssign","onAssignUpdate","onAssignCancel","documents","onAssignmentClick"])):(l(),c(p,{key:0},[o("div",Q,[W,o("button",{class:"newButton",onClick:e[0]||(e[0]=Y=>a.newGroup())},"+ Nov\xE1")]),g(r,{header:n.header,data:n.groups,onClick:a.openGroup},null,8,["header","data","onClick"])],64))])}var se=y(K,[["render",X]]);export{se as default};
